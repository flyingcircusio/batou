<?xml version="1.0" encoding="UTF-8"?>
<ruleset>
  <server-settings>
    <server>${component.address.listen}</server>
    <execute-pyref>false</execute-pyref>
    <dev-allow>
      127.0.0.1
      10.0.2.1/32
      217.246.0.236
      93.233.93.32
    </dev-allow>
    <dev-user username="${component.dev_user}" password="${component.dev_password}" />
    <display-local-files>false</display-local-files>
    <edit-local-files>false</edit-local-files>
  </server-settings>

  <!-- BEWARE: The following path matches that don't go to the upstream servers
       need to be synced with the nginx configuration. See
       ../nginx/config/webwork.conf  -->
  <proxy path="/Libraries">
    <dest href="{here}/themes/Prototype/Libraries" />
  </proxy>

  <proxy path="/Style">
    <dest href="{here}/themes/Prototype/Style" />
  </proxy>

  <proxy path="/Media">
    <dest href="{here}/themes/Prototype/Media" />
  </proxy>

  <proxy path="/_themes">
    <dest href="{here}/themes/Prototype" />
  </proxy>

  <proxy path="regex:^/main.js$">
    <dest href="{here}/themes/Prototype" />
  </proxy>

  <!-- TODO: fix this for general deployment -->
  <proxy path="regex:^/VirtualHostBase/http/.*:80/foo/VirtualHostRoot/$">
    <dest href="http://${component.upstream.connect}" />
  </proxy>

  <proxy path="wildcard:*">
    <dest href="http://${component.upstream.connect}" />
    <response rewrite-links="1" />
  </proxy>


  <!-- RULES -->
  <rule class="general" suppress-standard="1">

    <replace content="/html/head/title" theme="/html/head/title" />

    <replace content="script[data-main$='/main.js']"
             theme="script[data-main='main']" />

    <replace content="#buttons-contextual"
             theme="#buttons-contextual" />
 
    <drop theme="#global-header" />
    <drop theme="li.secure.settings" />

    <append content="#global-header" theme="body"/>
    <append content="li.secure.settings" theme="children:#carousel-control"/>
 
    <replace content="a.button.dashboard" theme="a.button.dashboard" />

    <append content="#webstats_js" theme="body"/>

    <append content="span#babble-client-chatdata" theme="body"/>
    <append content="a#chatpanel_chatrooms" theme="body"/>
    <append content="a#chatpanel_online_users" theme="body"/>

  </rule>

  <rule class="homepage" suppress-standard="1">
    <theme href="/_themes/index.html" />

    <!-- move the secondary nav links inside the relevant items -->
    <replace content="a[href$='#item-2'] + ul"
             theme="#item-2 aside.sidebar ul" />
    <replace content="a[href$='#item-3'] + ul"
            theme="#item-3 aside.sidebar ul" />
    <replace content="a[href$='#item-4'] + ul"
            theme="#item-4 aside.sidebar ul" />
    <replace content="a[href$='#item-5'] + ul"
            theme="#item-5 aside.sidebar ul" />
    <replace content="a[href$='#item-6'] + ul"
            theme="#item-6 aside.sidebar ul" />

    <replace content=".carousel-item"
             theme=".carousel-item"/>

    <drop theme=".carousel-item"/>
    <!-- drop any remaining sub nav links -->
    <drop content="#carousel-control li ul"/>

    <!-- homepage -->
    <replace content="#item-1 .column-1"
             theme="#item-1 .column-1" />
    <replace content="#item-1 .column-2"
             theme="#item-1 .column-2" />
    <replace content="#item-1 aside"
             theme="#item-1 aside" />
    <replace content="#item-1 .column-3"
             theme="#item-1 .column-3" />

    <!-- Activities -->
    <replace content="#item-2 .content-body"
             theme="#item-2 .content-body" />

    <!-- Headquarters -->
    <replace content="#item-3 .content-body"
             theme="#item-3 .content-body" />

    <!-- About -->
    <replace content="#item-4 .content-body"
             theme="#item-4 .content-body" />

    <!-- Memberships -->
    <replace content="#item-5 .content-body"
             theme="#item-5 .content-body" />

    <!-- Products, just show empty page for now -->
    <replace content="#item-6 .content-body"
             theme="#item-6 .content-body" />

    <!-- dashboard -->
    <replace content="#item-7 ul.tiles"
             theme="#item-7 ul.tiles" />

    <!-- Spaces -->
    <replace content="#item-8 .header"
             theme="#item-8 .header" />
    <replace content="#item-8 .tiles"
             theme="#item-8 .tiles" />
  </rule>

  <rule class="foo-types-workspace-view" suppress-standard="1">
    <theme href="/_themes/project-landing.html" />

    <replace content="#document-body"
             theme="#document-body" />

    <replace content="aside.sidebar"
             theme="aside.sidebar" />

    <replace content="form.functions"
             theme="form.functions" />

    <replace theme="a.button.icon.dashboard"
             content="#back-to-dashboard a" />
  </rule>

  <rule class="project-about" suppress-standard="1">
    <theme href="/_themes/project-about.html" />

    <replace content="#sidebar-content"
             theme="#sidebar-content" />
  </rule>

  <rule class="personal-data" suppress-standard="1">
    <theme href="/_themes/profile-liz.html" />
    <replace content="children:#address-body"
             theme="children:#address-body" />
  </rule>

  <rule class="search" suppress-standard="1">
    <theme href="/_themes/search-results.html" />
    <replace content="children:#search-body"
             theme="children:#search-body" />
  </rule>

  <rule class="pdf file-pdf.html" suppress-standard="1">
    <theme href="/_themes/waste-not-want-not.html" />

    <replace content="script[data-main$='main.js']"
             theme="script[data-main$='main']" />
    <replace content="children:#document-body"
             theme="children:#document-body" />

    <replace content="aside.sidebar"
             theme="aside.sidebar" />

    <!-- Dropping the left hand sidebar preview for now -->
    <drop theme="ol.toc.previews" />
  </rule>

  <rule class="document-document_view" suppress-standard="1">
    <theme href="/_themes/out-of-the-box.html" />

    <replace content="#document-body"
             theme="#document-body" />
  </rule>

  <rule class="legal" suppress-standard="1">
    <theme href="/_themes/plain-dark.html" />

    <append content="#content"
             theme="children:#document-body" />
  </rule>

  <rule class="cipslisting" suppress-standard="1">
    <theme href="/_themes/plain-dark.html" />

    <append content="#content"
             theme="children:#document-body" />
  </rule>

  <rule class="simplelistusers" suppress-standard="1">
    <theme href="/_themes/plain-dark.html" />
    <replace content="#document-body"
             theme="#document-body" />
  </rule>

  <rule class="sharing">
    <theme href="/_themes/plain-dark.html" />
    <append content="children:#content"
            theme="children:#document-body" />
  </rule>

  <rule class="file-pedit">
    <theme href="/_themes/plain-dark.html" />
    <append content="children:#document-body"
            theme="children:#document-body" />
  </rule>

  <rule class="form document-at_base_edit_view 
    vsevent-at_base_edit_view 
    news-item-at_base_edit_view
    file-at_base_edit_view
    image-at_base_edit_view" suppress-standard="1">
    <theme href="/_themes/plain-dark.html" />
    <append content="#content"
             theme="children:#document-body" />
  </rule>

  <rule class="folder_contents folder_summary_view login_form newsitem_view vsevent-vs_event_view vsevent-at_base_edit_view topic-plone news-item-plone page_template historyview foo-types-contract-view topic-solgemafullcalendar_view foo-types-product-view babble-client-chatroom-view" 
        suppress-standard="1">
    <theme href="/_themes/plain-dark.html" />
    <append content="#content"
             theme="children:#document-body" />
  </rule>

  <rule class="notheme" suppress-standard="1">
  </rule>

</ruleset>

